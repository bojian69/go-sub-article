# ============================================================
# WeChat Subscription Service 配置文件
# ============================================================
# 
# 本服务支持两种模式获取公众号图文内容：
# 
# 【模式一】简单模式 (simple_mode)
#   - 适用于：获取自己公众号的图文内容
#   - 原理：直接使用公众号 AppID/AppSecret 获取 access_token
#   - 优点：配置简单，无需搭建第三方平台
#   - 要求：公众号必须是认证的服务号
#
# 【模式二】第三方平台模式 (component)
#   - 适用于：代运营多个公众号的 SaaS 平台
#   - 原理：通过第三方平台授权获取 authorizer_access_token
#   - 优点：可管理多个授权公众号
#   - 要求：需要在微信开放平台注册第三方平台
#
# 切换方式：设置 simple_mode.enabled 为 true 或 false
# ============================================================

server:
  http_port: 8080
  grpc_port: 9090

redis:
  host: localhost
  port: 6379
  password: ""
  db: 0

wechat:
  # ============================================================
  # 【模式一】简单模式配置
  # ============================================================
  # 
  # 如何获取 AppID 和 AppSecret：
  # 1. 登录微信公众平台 https://mp.weixin.qq.com
  # 2. 左侧菜单：设置与开发 → 基本配置
  # 3. 公众号开发信息中找到 AppID
  # 4. 点击"重置"获取 AppSecret（只显示一次，请妥善保存）
  #
  # 注意事项：
  # - 需要认证的服务号才能调用图文接口
  # - 订阅号无法使用此功能
  # - AppSecret 重置后旧的会立即失效
  # ============================================================
  
  simple_mode:
    enabled: true                           # true=使用简单模式, false=使用第三方平台模式
    accounts:
      - app_id: "wx1234567890abcdef"        # 公众号 AppID
        app_secret: "your_appsecret_here"   # 公众号 AppSecret
      # 可配置多个公众号
      # - app_id: "wx0987654321fedcba"
      #   app_secret: "another_appsecret"

  # ============================================================
  # 【模式二】第三方平台模式配置
  # ============================================================
  # 
  # 仅当 simple_mode.enabled = false 时生效
  #
  # 如何获取这些参数：
  # 
  # 1. component.app_id / component.app_secret
  #    - 登录微信开放平台 https://open.weixin.qq.com
  #    - 管理中心 → 第三方平台 → 查看详情
  #    - 在"开发信息"中找到 AppID 和 AppSecret
  #
  # 2. component.verify_ticket
  #    - 微信每隔10分钟会向你的服务器推送 component_verify_ticket
  #    - 推送地址：第三方平台设置的"授权事件接收URL"
  #    - 需要你的服务接收并存储这个 ticket
  #    - 首次配置可以手动触发：全网发布 → 获取 ticket
  #
  # 3. authorizers[].app_id
  #    - 授权公众号的 AppID
  #    - 在公众号授权成功后，从授权回调中获取
  #
  # 4. authorizers[].refresh_token
  #    - 授权公众号的 authorizer_refresh_token
  #    - 在公众号授权成功后，从授权回调中获取
  #    - 每次刷新 token 后会返回新的 refresh_token，需要更新存储
  #
  # 授权流程简述：
  # 1. 生成授权链接，引导公众号管理员扫码授权
  # 2. 授权成功后，微信回调你的服务器
  # 3. 从回调中获取 authorizer_appid 和 authorizer_refresh_token
  # 4. 将这些信息配置到 authorizers 列表中
  # ============================================================
  
  component:
    app_id: ""                              # 第三方平台 AppID
    app_secret: ""                          # 第三方平台 AppSecret
    verify_ticket: ""                       # component_verify_ticket（微信定时推送）

  authorizers:                              # 授权公众号列表
    []
    # - app_id: "wxabc123456789"            # 授权公众号 AppID
    #   refresh_token: "refreshtoken_xxx"   # authorizer_refresh_token
    # - app_id: "wxdef987654321"            # 可配置多个授权公众号
    #   refresh_token: "refreshtoken_yyy"
